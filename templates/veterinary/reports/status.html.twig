{% extends 'baseDash.html.twig' %}

{% block title %}État des animaux{% endblock %}

{% block body %}
    <div class="containerAdmin">
        <div class="row dash">
            {% include "_partials/_adminnav.html.twig" %}
            <main class="col-9 border bg-white p-2">
                <h4>Etats des animaux</h4>
                <!-- Formulaire de filtre -->
                <form method="get" action="{{ path('vet_animal_status') }}">
    <!-- Filtre par race -->
    <label for="breed">Race</label>
    <select name="breed" id="breed">
        <option value="">-- Sélectionner --</option>
        {% for race in races %}
            <option value="{{ race.breed }}" {% if breedFilter == race.breed %}selected{% endif %}>{{ race.breed }}</option>
        {% endfor %}
    </select>

    <!-- Filtre par nom -->
    <label for="name">Nom de l'animal</label>
    <input type="text" name="name" id="name" value="{{ nameFilter }}" />

    <!-- Filtre par habitat -->
    <label for="habitat">Habitat</label>
    <select name="habitat" id="habitat">
        <option value="">-- Sélectionner --</option>
        {% for habitat in habitats %}
            <option value="{{ habitat.name }}" {% if habitatFilter == habitat.name %}selected{% endif %}>{{ habitat.name }}</option>
        {% endfor %}
    </select>

    <button type="submit">Filtrer</button>
</form>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Race</th>
                                <th>Habitat</th>
                                <th>Dernier état</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for animal in animals %}
            <tr>
                <td>{{ animal.nameAnimal }}</td>
                <td>{{ animal.breed }}</td>
                <td>{{ animal.idHabitats.name }}</td>
                <td>
                    {% set latestReport = animal.idReportsVet|first %}
                    {{ latestReport ? latestReport.state : 'Aucun état disponible' }}
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="4">Aucun animal trouvé avec ces filtres.</td>
            </tr>
        {% endfor %}

                        </tbody>
                    </table>
                </div>
            </main>  
        </div>
    </div>
{% endblock %}
